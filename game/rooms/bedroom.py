import pygame
from .base_room import BaseRoom
from entities.buttons import Button
from config import *


class Bedroom(BaseRoom):
    """–ö–ª–∞—Å—Å —Å–ø–∞–ª—å–Ω–∏ –≤ –∏–≥—Ä–µ Tamagotchi Pou.
    
    –°–ø–∞–ª—å–Ω—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ª–æ–∂–∏—Ç—å —Ç–∞–º–∞–≥–æ—á–∏ —Å–ø–∞—Ç—å
    –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏. –í–∏–∑—É–∞–ª—å–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    —Å–Ω–∞ –∏ —É—Ä–æ–≤–µ–Ω—å —ç–Ω–µ—Ä–≥–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.
    
    –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
    - –ö—Ä–æ–≤–∞—Ç—å –¥–ª—è —Å–Ω–∞ —Ç–∞–º–∞–≥–æ—á–∏
    - –ù–æ—á–Ω–æ–π —Å—Ç–æ–ª–∏–∫ —Å —á–∞—Å–∞–º–∏
    - –û–∫–Ω–æ —Å –º–µ–Ω—è—é—â–∏–º—Å—è –≤–∏–¥–æ–º (—Å–æ–ª–Ω—Ü–µ/–ª—É–Ω–∞)
    - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —ç–Ω–µ—Ä–≥–∏–∏
    - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–°–ø–∞—Ç—å"
    """
    
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–ø–∞–ª—å–Ω—é.
        
        –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ-—Å–∏–Ω–∏–π —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç
        —ç–ª–µ–º–µ–Ω—Ç—ã –∫–æ–º–Ω–∞—Ç—ã –¥–ª—è –æ—Ç–¥—ã—Ö–∞ —Ç–∞–º–∞–≥–æ—á–∏.
        """
        super().__init__("Bedroom", (100, 100, 150))  # –§–∏–æ–ª–µ—Ç–æ–≤–æ-—Å–∏–Ω–∏–π —Ñ–æ–Ω
        self.setup()

    def setup(self):
        """–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∞–ª—å–Ω–∏.
        
        –°–æ–∑–¥–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã.
        –£–±—Ä–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥", —Ç–∞–∫ –∫–∞–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏—è –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è
        —á–µ—Ä–µ–∑ —Å—Ç—Ä–µ–ª–∫–∏ –ø–æ –±–æ–∫–∞–º —ç–∫—Ä–∞–Ω–∞.
        """
        # –¢–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∞ —Å–Ω–∞, –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" —É–±—Ä–∞–Ω–∞
        self.buttons = [
            Button(600, 500, 150, 50, "Sleep", BLUE)  # –ö–Ω–æ–ø–∫–∞ "–°–ø–∞—Ç—å"
        ]

    def draw(self, screen, tamagotchi):
        """–û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç —Å–ø–∞–ª—å–Ω—é.
        
        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
            screen: –ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å PyGame –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
            tamagotchi: –û–±—ä–µ–∫—Ç —Ç–∞–º–∞–≥–æ—á–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
            
        –ü–æ—Ä—è–¥–æ–∫ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏:
        1. –§–æ–Ω –∫–æ–º–Ω–∞—Ç—ã –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫
        2. –ú–µ–±–µ–ª—å –∏ –æ–±—ä–µ–∫—Ç—ã –∫–æ–º–Ω–∞—Ç—ã
        3. –°—Ç–∞—Ç—É—Å —Å–Ω–∞ –∏ —ç–Ω–µ—Ä–≥–∏–∏
        4. –¢–∞–º–∞–≥–æ—á–∏
        5. –ö–Ω–æ–ø–∫–∏ –∏ —Å—Ç—Ä–µ–ª–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        """
        # –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ñ–æ–Ω –∫–æ–º–Ω–∞—Ç—ã –±–µ–∑ —Ç–∞–º–∞–≥–æ—á–∏ —Å–Ω–∞—á–∞–ª–∞
        screen.fill(self.background_color)
        title = self.font.render(f"{self.name}", True, WHITE)
        screen.blit(title, (SCREEN_WIDTH // 2 - title.get_width() // 2, 30))
        
        # –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –∫–æ–º–Ω–∞—Ç—ã
        for obj in self.objects:
            obj.draw(screen)

        # –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –º–µ–±–µ–ª—å —Å–ø–∞–ª—å–Ω–∏
        
        # –ö—Ä–æ–≤–∞—Ç—å
        pygame.draw.rect(screen, (139, 69, 19), (200, 200, 300, 150), border_radius=10)  # –ö–æ—Ä–∏—á–Ω–µ–≤–∞—è —Ä–∞–º–∫–∞
        pygame.draw.rect(screen, (255, 255, 255), (210, 210, 280, 130), border_radius=10)  # –ë–µ–ª–æ–µ –æ–¥–µ—è–ª–æ
        pygame.draw.rect(screen, (200, 0, 0), (220, 220, 260, 110), border_radius=10)  # –ö—Ä–∞—Å–Ω–∞—è –ø—Ä–æ—Å—Ç—ã–Ω—è

        # –ü–æ–¥—É—à–∫–∏
        pygame.draw.ellipse(screen, WHITE, (230, 230, 60, 40))   # –õ–µ–≤–∞—è –ø–æ–¥—É—à–∫–∞
        pygame.draw.ellipse(screen, WHITE, (310, 230, 60, 40))   # –ü—Ä–∞–≤–∞—è –ø–æ–¥—É—à–∫–∞

        # –ù–æ—á–Ω–æ–π —Å—Ç–æ–ª–∏–∫ —Å —á–∞—Å–∞–º–∏
        pygame.draw.rect(screen, (160, 120, 80), (150, 250, 60, 100))  # –°—Ç–æ–ª–∏–∫
        pygame.draw.circle(screen, WHITE, (180, 280), 20)  # –¶–∏—Ñ–µ—Ä–±–ª–∞—Ç
        pygame.draw.circle(screen, BLACK, (180, 280), 20, 2)  # –†–∞–º–∫–∞ —á–∞—Å–æ–≤
        # –°—Ç—Ä–µ–ª–∫–∏ —á–∞—Å–æ–≤
        pygame.draw.line(screen, BLACK, (180, 280), (180, 270), 2)  # –ú–∏–Ω—É—Ç–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞
        pygame.draw.line(screen, BLACK, (180, 280), (190, 280), 1)  # –ß–∞—Å–æ–≤–∞—è —Å—Ç—Ä–µ–ª–∫–∞

        # –û–∫–Ω–æ —Å –≤–∏–¥–æ–º
        pygame.draw.rect(screen, (50, 50, 100), (500, 150, 150, 100))  # –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —á–∞—Å—Ç—å –æ–∫–Ω–∞
        pygame.draw.rect(screen, (100, 100, 150), (500, 150, 150, 100), 5)  # –†–∞–º–∞ –æ–∫–Ω–∞
        pygame.draw.line(screen, (100, 100, 150), (575, 150), (575, 250), 3)  # –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∞
        pygame.draw.line(screen, (100, 100, 150), (500, 200), (650, 200), 3)  # –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∞

        # –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –ª—É–Ω—É/–∑–≤–µ–∑–¥—ã –∏–ª–∏ —Å–æ–ª–Ω—Ü–µ —á–µ—Ä–µ–∑ –æ–∫–Ω–æ
        if tamagotchi and tamagotchi.is_sleeping:
            # –ù–æ—á–Ω–æ–π –≤–∏–¥, –µ—Å–ª–∏ —Ç–∞–º–∞–≥–æ—á–∏ —Å–ø–∏—Ç
            pygame.draw.circle(screen, YELLOW, (575, 200), 15)  # –õ—É–Ω–∞
            # –ó–≤–µ–∑–¥—ã
            for i in range(5):
                star_x = 500 + 20 + i * 25
                star_y = 160 + (i % 3) * 15
                pygame.draw.circle(screen, WHITE, (star_x, star_y), 2)
        else:
            # –î–Ω–µ–≤–Ω–æ–π –≤–∏–¥, –µ—Å–ª–∏ —Ç–∞–º–∞–≥–æ—á–∏ –Ω–µ —Å–ø–∏—Ç
            pygame.draw.circle(screen, (255, 255, 200), (575, 200), 20)  # –°–æ–ª–Ω—Ü–µ

        # –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å —Å–Ω–∞
        if tamagotchi and tamagotchi.is_sleeping:
            sleep_text = self.font.render("Zzz... Sleeping", True, WHITE)
            screen.blit(sleep_text, (300, 400))

        # –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å —ç–Ω–µ—Ä–≥–∏–∏
        if tamagotchi:
            energy_text = self.font.render(f"Energy: {tamagotchi.data.energy}/100", True, WHITE)
            screen.blit(energy_text, (50, 100))

            # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–∏–∑–∫–æ–π —ç–Ω–µ—Ä–≥–∏–∏
            if tamagotchi.data.energy < 30:
                low_energy_text = self.small_font.render("Low energy! Time to sleep!", True, YELLOW)
                screen.blit(low_energy_text, (50, 130))
        
        # –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–∞–º–∞–≥–æ—á–∏ –ø–æ—Å–ª–µ –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç—É—Ä (—Å–ø–µ—Ä–µ–¥–∏)
        if tamagotchi:
            tamagotchi.draw(screen, SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2)
        
        # –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
        for button in self.buttons:
            button.draw(screen)
        
        # –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å—Ç—Ä–µ–ª–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        self.draw_navigation_arrows(screen)

    def handle_events(self, event, mouse_pos, tamagotchi, game_core):
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ —Å–ø–∞–ª—å–Ω–µ.
        
        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
            event: –°–æ–±—ã—Ç–∏–µ PyGame –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
            mouse_pos: –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è –∫—É—Ä—Å–æ—Ä–∞ –º—ã—à–∏ (x, y)
            tamagotchi: –û–±—ä–µ–∫—Ç —Ç–∞–º–∞–≥–æ—á–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
            game_core: –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—ä–µ–∫—Ç –∏–≥—Ä—ã –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
            
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
            str: –ò–º—è –∫–æ–º–Ω–∞—Ç—ã –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ ("bedroom" –∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)
            
        –ú–µ—Ö–∞–Ω–∏–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:
        - –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫–µ "Sleep": –ø–æ–ø—ã—Ç–∫–∞ —É–ª–æ–∂–∏—Ç—å —Ç–∞–º–∞–≥–æ—á–∏ —Å–ø–∞—Ç—å
        - –ö–ª–∏–∫ –Ω–∞ —Å—Ç—Ä–µ–ª–∫–∞—Ö –Ω–∞–≤–∏–≥–∞—Ü–∏–∏: –ø–µ—Ä–µ—Ö–æ–¥ –≤ —Å–æ—Å–µ–¥–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
        """
        # –°–Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é —Å—Ç—Ä–µ–ª–∫–∞–º–∏ —á–µ—Ä–µ–∑ –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å
        result = super().handle_events(event, mouse_pos, tamagotchi, game_core)
        if result:
            return result

        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ª–µ–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏
        if event.type == pygame.MOUSEBUTTONDOWN and event.button == 1:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–Ω–æ–ø–∫—É "–°–ø–∞—Ç—å"
            if self.buttons[0].rect.collidepoint(mouse_pos):
                if tamagotchi:
                    if tamagotchi.sleep():
                        # –£—Å–ø–µ—à–Ω–æ —É–ª–æ–∂–∏–ª–∏ —Å–ø–∞—Ç—å
                        game_core.show_message("Your tamagotchi is sleeping... üò¥")
                        game_core.auto_save()  # –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ —É–∫–ª–∞–¥—ã–≤–∞–Ω–∏—è —Å–ø–∞—Ç—å
                    else:
                        # –ù–µ —É–¥–∞–ª–æ—Å—å —É–ª–æ–∂–∏—Ç—å —Å–ø–∞—Ç—å
                        if tamagotchi.is_sleeping:
                            game_core.show_message("Already sleeping!")  # –£–∂–µ —Å–ø–∏—Ç
                        else:
                            game_core.show_message("Not tired enough!")  # –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É—Å—Ç–∞–ª
                return "bedroom"

        # –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–≤–µ–¥–µ–Ω–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏
        for button in self.buttons:
            button.check_hover(mouse_pos)

        # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Å—Ç–∞–µ–º—Å—è –≤ —Å–ø–∞–ª—å–Ω–µ
        return "bedroom"