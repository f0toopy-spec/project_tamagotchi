import pygame
from .base_room import BaseRoom
from entities.buttons import Button
from config import *


class Kitchen(BaseRoom):
    """–ö–ª–∞—Å—Å –∫—É—Ö–Ω–∏ –≤ –∏–≥—Ä–µ Tamagotchi Pou.
    
    –ö—É—Ö–Ω—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–æ—Ä–º–∏—Ç—å —Ç–∞–º–∞–≥–æ—á–∏ —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏.
    –ó–¥–µ—Å—å –Ω–∞—Ö–æ–¥—è—Ç—Å—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –µ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –¥–∞–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂—É.
    –í–∏–∑—É–∞–ª—å–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å –≥–æ–ª–æ–¥–∞ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∫–æ—Ä–º–ª–µ–Ω–∏—é.
    
    –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
    - –†–∞–∑–ª–∏—á–Ω—ã–µ –≤–∏–¥—ã –µ–¥—ã –Ω–∞ —Å—Ç–æ–ª–µ—à–Ω–∏—Ü–µ
    - –ö—É—Ö–æ–Ω–Ω–∞—è –º–µ–±–µ–ª—å: –ø–ª–∏—Ç–∞, —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫, —Ä–∞–∫–æ–≤–∏–Ω–∞
    - –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è –≥–æ–ª–æ–¥–∞ —Ç–∞–º–∞–≥–æ—á–∏
    - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
    - –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –≥–æ–ª–æ–¥–∞ –ø–æ—Å–ª–µ –∫–æ—Ä–º–ª–µ–Ω–∏—è
    """
    
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫—É—Ö–Ω—é.
        
        –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–≤–µ—Ç–ª–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π —Ü–≤–µ—Ç —Ñ–æ–Ω–∞ –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç
        —Ñ–ª–∞–≥–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—É—á–∞—é—â–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤ –∏ —à–∫–∞–ª—ã –≥–æ–ª–æ–¥–∞.
        """
        super().__init__("Kitchen", (200, 180, 150))  # –°–≤–µ—Ç–ª–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π —Ñ–æ–Ω
        self.setup()
        # –§–ª–∞–≥–∏ –¥–ª—è –æ–±—É—á–∞—é—â–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤ –∏ —à–∫–∞–ª—ã –≥–æ–ª–æ–¥–∞
        self.show_hunger_text = True    # –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–∫—Å—Ç —Å —É—Ä–æ–≤–Ω–µ–º –≥–æ–ª–æ–¥–∞
        self.show_instructions = True   # –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
        self.hunger_bar_timer = 0       # –¢–∞–π–º–µ—Ä –¥–ª—è —à–∫–∞–ª—ã –≥–æ–ª–æ–¥–∞
        self.hunger_bar_duration = 2000  # –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∫–∞–∑–∞ —à–∫–∞–ª—ã (–º—Å)

    def setup(self):
        """–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã –∫—É—Ö–Ω–∏.
        
        –°–æ–∑–¥–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ —Ä–∞–∑–º–µ—â–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ
        –ø—Ä–µ–¥–º–µ—Ç—ã –µ–¥—ã –Ω–∞ –∫—É—Ö–æ–Ω–Ω–æ–π —Å—Ç–æ–ª–µ—à–Ω–∏—Ü–µ.
        """
        # –ö–Ω–æ–ø–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        self.buttons = [
            Button(50, 500, 150, 50, "Back to Hall", GRAY)  # –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥ –≤ –∑–∞–ª"
        ]

        # –ü—Ä–µ–¥–º–µ—Ç—ã –µ–¥—ã –Ω–∞ —Å—Ç–æ–ª–µ—à–Ω–∏—Ü–µ
        # –ö–∞–∂–¥—ã–π –ø—Ä–µ–¥–º–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: –Ω–∞–∑–≤–∞–Ω–∏–µ, –ø–æ–∑–∏—Ü–∏—é, —Ü–≤–µ—Ç, —Ä–∞–∑–º–µ—Ä –∏ –Ω–∞—Å—ã—â–µ–Ω–∏–µ
        self.food_items = [
            {"name": "Apple", "x": 200, "y": 200, "color": RED, "size": 25, "hunger": 20},
            {"name": "Banana", "x": 300, "y": 200, "color": YELLOW, "size": 30, "hunger": 25},
            {"name": "Pizza", "x": 400, "y": 200, "color": (255, 165, 0), "size": 35, "hunger": 50},
            {"name": "Milk", "x": 500, "y": 200, "color": WHITE, "size": 30, "hunger": 15},
        ]

    def draw(self, screen, tamagotchi):
        """–û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç –∫—É—Ö–Ω—é.
        
        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
            screen: –ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å PyGame –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
            tamagotchi: –û–±—ä–µ–∫—Ç —Ç–∞–º–∞–≥–æ—á–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
            
        –ü–æ—Ä—è–¥–æ–∫ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏:
        1. –§–æ–Ω –∫–æ–º–Ω–∞—Ç—ã —á–µ—Ä–µ–∑ –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å (–±–µ–∑ —Ç–∞–º–∞–≥–æ—á–∏)
        2. –ö—É—Ö–æ–Ω–Ω–∞—è –º–µ–±–µ–ª—å –∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ
        3. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –µ–¥—ã
        4. –¢–∞–º–∞–≥–æ—á–∏ (–ø–æ–≤–µ—Ä—Ö –º–µ–±–µ–ª–∏)
        5. –û–±—É—á–∞—é—â–∏–µ —Ç–µ–∫—Å—Ç—ã –∏ —à–∫–∞–ª–∞ –≥–æ–ª–æ–¥–∞
        6. –ö–Ω–æ–ø–∫–∏ –∏ —Å—Ç—Ä–µ–ª–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        """
        # –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É –±–µ–∑ —Ç–∞–º–∞–≥–æ—á–∏ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–æ–∑–∏—Ü–∏–∏ –∏ —Å–ª–æ–µ–≤
        super().draw(screen, None)

        # –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫—É—Ö–æ–Ω–Ω—É—é –º–µ–±–µ–ª—å
        
        # –°—Ç–æ–ª–µ—à–Ω–∏—Ü–∞
        pygame.draw.rect(screen, (139, 69, 19), (150, 150, 500, 100))  # –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å
        pygame.draw.rect(screen, (160, 120, 80), (150, 250, 500, 50))  # –§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å

        # –ü–ª–∏—Ç–∞
        pygame.draw.rect(screen, (100, 100, 100), (200, 300, 100, 80))  # –ö–æ—Ä–ø—É—Å –ø–ª–∏—Ç—ã
        pygame.draw.circle(screen, BLACK, (225, 340), 15)  # –õ–µ–≤–∞—è –∫–æ–Ω—Ñ–æ—Ä–∫–∞
        pygame.draw.circle(screen, BLACK, (275, 340), 15)  # –ü—Ä–∞–≤–∞—è –∫–æ–Ω—Ñ–æ—Ä–∫–∞

        # –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫
        pygame.draw.rect(screen, (220, 220, 220), (450, 300, 100, 150))  # –ö–æ—Ä–ø—É—Å
        pygame.draw.rect(screen, (180, 180, 180), (460, 310, 80, 130))   # –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —á–∞—Å—Ç—å
        pygame.draw.rect(screen, (150, 150, 150), (495, 350, 10, 40))    # –†—É—á–∫–∞

        # –†–∞–∫–æ–≤–∏–Ω–∞
        pygame.draw.rect(screen, (200, 200, 200), (350, 300, 80, 60))   # –ö–æ—Ä–ø—É—Å
        pygame.draw.rect(screen, (150, 200, 255), (360, 310, 60, 40))   # –í–æ–¥–∞

        # –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã –µ–¥—ã
        for food in self.food_items:
            # –†–∏—Å—É–µ–º –∫—Ä—É–≥, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π –µ–¥—É
            pygame.draw.circle(screen, food["color"], (food["x"], food["y"]), food["size"])

            # –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –µ–¥—ã
            name_text = self.small_font.render(food["name"], True, BLACK)
            screen.blit(name_text, (food["x"] - 25, food["y"] + food["size"] + 5))

        # –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ç–∞–º–∞–≥–æ—á–∏ –ø–æ–≤–µ—Ä—Ö –º–µ–±–µ–ª–∏
        if tamagotchi:
            tamagotchi.draw(screen, SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 + 80)

            # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ–±—É—á–∞—é—â–∏–µ —Ç–µ–∫—Å—Ç—ã (–º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–∫–∞)
            if self.show_hunger_text:
                hunger_text = self.font.render(f"Hunger: {tamagotchi.data.hunger}/100", True, WHITE)
                # –ü–æ–¥–Ω–∏–º–∞–µ–º —Ç–µ–∫—Å—Ç –≤—ã—à–µ
                screen.blit(hunger_text, (50, 40))

            if self.show_instructions:
                instructions = self.small_font.render("Click on food to feed your tamagotchi!", True, WHITE)
                screen.blit(instructions, (50, 70))

            # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –≥–æ–ª–æ–¥–µ
            if tamagotchi.data.hunger < 30 and self.show_instructions:
                hungry_text = self.small_font.render("Your tamagotchi is hungry! Feed it!", True, YELLOW)
                screen.blit(hungry_text, (50, 100))

            # –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –≥–æ–ª–æ–¥–∞ –ø–æ—Å–ª–µ –∫–æ—Ä–º–ª–µ–Ω–∏—è
            if self.hunger_bar_timer:
                now = pygame.time.get_ticks()
                if now - self.hunger_bar_timer < self.hunger_bar_duration:
                    bar_x, bar_y, bar_w, bar_h = 50, 80, 300, 18  # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —à–∫–∞–ª—ã
                    # –§–æ–Ω —à–∫–∞–ª—ã
                    pygame.draw.rect(screen, (50, 50, 50), (bar_x, bar_y, bar_w, bar_h))
                    # –ó–∞–ª–∏–≤–∫–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —É—Ä–æ–≤–Ω—é –≥–æ–ª–æ–¥–∞
                    fill_w = int(bar_w * tamagotchi.data.hunger / 100)
                    pygame.draw.rect(screen, GREEN, (bar_x, bar_y, fill_w, bar_h))
                    # –†–∞–º–∫–∞ —à–∫–∞–ª—ã
                    pygame.draw.rect(screen, WHITE, (bar_x, bar_y, bar_w, bar_h), 2)
                else:
                    # –°–∫—Ä—ã–≤–∞–µ–º —à–∫–∞–ª—É –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
                    self.hunger_bar_timer = 0

    def handle_events(self, event, mouse_pos, tamagotchi, game_core):
        """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ –∫—É—Ö–Ω–µ.
        
        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
            event: –°–æ–±—ã—Ç–∏–µ PyGame –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
            mouse_pos: –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è –∫—É—Ä—Å–æ—Ä–∞ –º—ã—à–∏ (x, y)
            tamagotchi: –û–±—ä–µ–∫—Ç —Ç–∞–º–∞–≥–æ—á–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
            game_core: –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—ä–µ–∫—Ç –∏–≥—Ä—ã –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–±—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
            
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
            str: –ò–º—è –∫–æ–º–Ω–∞—Ç—ã –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ ("hall", "kitchen" –∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏)
            
        –ú–µ—Ö–∞–Ω–∏–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è:
        1. –õ—é–±–æ–π –∫–ª–∏–∫ –≤ –∫–æ–º–Ω–∞—Ç–µ —Å–∫—Ä—ã–≤–∞–µ—Ç –æ–±—É—á–∞—é—â–∏–µ —Ç–µ–∫—Å—Ç—ã
        2. –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫–µ "–ù–∞–∑–∞–¥": –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω—ã–π –∑–∞–ª
        3. –ö–ª–∏–∫ –Ω–∞ –µ–¥–µ: –∫–æ—Ä–º–ª–µ–Ω–∏–µ —Ç–∞–º–∞–≥–æ—á–∏
        4. –ù–∞–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏
        """
        # –°–Ω–∞—á–∞–ª–∞ –¥–∞–µ–º –±–∞–∑–æ–≤–æ–º—É –∫–ª–∞—Å—Å—É –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é —Å—Ç—Ä–µ–ª–∫–∞–º–∏ –º–µ–∂–¥—É –∫–æ–º–Ω–∞—Ç–∞–º–∏
        result = super().handle_events(event, mouse_pos, tamagotchi, game_core)
        if result:
            return result

        # –õ—é–±–æ–π –∫–ª–∏–∫ –≤ –∫–æ–º–Ω–∞—Ç–µ —Å–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–¥—Å–∫–∞–∑–æ—á–Ω—ã–µ –Ω–∞–¥–ø–∏—Å–∏
        if event.type == pygame.MOUSEBUTTONDOWN and event.button == 1:
            self.show_hunger_text = False
            self.show_instructions = False

        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ª–µ–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –º—ã—à–∏
        if event.type == pygame.MOUSEBUTTONDOWN and event.button == 1:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
            if self.buttons[0].rect.collidepoint(mouse_pos):
                return "hall"

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã –µ–¥—ã
            for food in self.food_items:
                # –†–∞—Å—á–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –æ—Ç –∫–ª–∏–∫–∞ –¥–æ —Ü–µ–Ω—Ç—Ä–∞ –µ–¥—ã
                distance = ((mouse_pos[0] - food["x"]) ** 2 + (mouse_pos[1] - food["y"]) ** 2) ** 0.5
                if distance <= food["size"]:
                    if tamagotchi:
                        if tamagotchi.feed(food["hunger"]):
                            # –£—Å–ø–µ—à–Ω–æ–µ –∫–æ—Ä–º–ª–µ–Ω–∏–µ
                            game_core.show_message(f"Yum! Ate {food['name']}! üçé")
                            # –ü–æ–∫–∞–∑–∞—Ç—å —à–∫–∞–ª—É –≥–æ–ª–æ–¥–∞ –Ω–∞ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è
                            self.hunger_bar_timer = pygame.time.get_ticks()
                        else:
                            # –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–∫–æ—Ä–º–∏—Ç—å (–≤–æ–∑–º–æ–∂–Ω–æ, –Ω–µ –≥–æ–ª–æ–¥–µ–Ω)
                            game_core.show_message("Not hungry enough!")
                    # –û—Å—Ç–∞–µ–º—Å—è –≤ —Ç–æ–π –∂–µ –∫–æ–º–Ω–∞—Ç–µ –ø–æ—Å–ª–µ –∫–æ—Ä–º–ª–µ–Ω–∏—è
                    return "kitchen"

        # –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–≤–µ–¥–µ–Ω–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏
        for button in self.buttons:
            button.check_hover(mouse_pos)

        # –ë–µ–∑ —Å–º–µ–Ω—ã –∫–æ–º–Ω–∞—Ç—ã
        return "kitchen"